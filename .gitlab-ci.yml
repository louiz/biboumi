stages:
  - deploy    # Deploy things like the web doc

before_script:
  - uname -a
  - whoami

variables:
  COMPILER: "g++"
  BUILD_TYPE: "Debug"
  BOTAN: "-DWITH_BOTAN=1"
  UDNS: "-DWITH_UDNS=1"
  SYSTEMD: "-DWITH_SYSTEMD=1"
  LIBIDN: "-DWITH_LIBIDN=1"
  SQLITE3: "-DWITH_SQLITE3=1"
  POSTGRESQL: "-WITH_POSTGRESQL=1"

doc_tag:
  stage: deploy
  only:
    - tags@testing/biboumi
  tags:
    - www
  environment:
    name: doc.$CI_COMMIT_TAG
    url: https://doc.biboumi.louiz.org/$CI_COMMIT_TAG/
  image: docker.louiz.org/louiz/biboumi/doc-builder
  script:
    - cd doc/
    - make html
    - mv _build/html /www/$CI_COMMIT_TAG
  dependencies: []

undeploy_doc_tag:
  stage: deploy
  only:
    - tags@testing/biboumi
  tags:
    - www
  variables:
    GIT_STRATEGY: none
  environment:
    name: doc.$CI_COMMIT_TAG
    url: https://doc.biboumi.louiz.org/$CI_COMMIT_TAG/
  image: docker.louiz.org/louiz/biboumi/doc-builder
  script:
    - rm -rf /www/$CI_COMMIT_TAG
  dependencies: []
